<script type="text/x-template" id="v-registrations">
{% verbatim %}
  <div v-if="event && registrations.length">
    <q-card class="hipeac__card q-mt-lg q-pa-sm">
      <!--<hipeac-search-box eventName="acaces-reg-query" placeholder="Search by name, affiliation, country..."></hipeac-search-box>-->
      <hipeac-search-bar v-model="query" placeholder="Search by name, affiliation, country..." :filters="filtersWithCountries" />
    </q-card>

    <q-card class="hipeac__card q-mt-sm q-mb-lg">
      <q-card-section>
        <!--<acaces-registrations-table :data="items" :id="id" :admittedIds="event.custom_data.admitted_ids" :grantedIds="event.custom_data.granted_ids" :grantsPerCountry="grantsPerCountry" :tracks="simpleTracks" :courses="courses"></acaces-registrations-table>-->
        <q-table flat dense row-key="id" :data="remappedRegistrations" :columns="table.columns" :pagination="table.pagination" :filter="query" :filter-method="customFilter" @row-click="function (e, row) { $router.replace({params: {id: row.id}}) }">
          <template v-slot:body-cell-idx="props">
            <q-td auto-width :props="props">
              <samp>{{ props.rowIndex + 1 }}</samp>
            </q-td>
          </template>
          <template v-slot:body-cell-accepted="props">
            <q-td auto-width :props="props">
              <q-icon v-if="props.row.status == 1" name="check_circle_outline" color="positive" size="16px" />
              <q-icon v-else-if="props.row.status == 2" name="check_circle" color="positive" size="16px" />
              <q-icon v-else-if="props.row.status == 9" name="cancel" color="negative" size="16px" />
              <q-icon v-else name="help" color="grey-4" size="16px" />
            </q-td>
          </template>
          <template v-slot:body-cell-admitted="props">
            <q-td auto-width :props="props">
              <q-toggle size="xs" v-model="event.custom_data.admitted_ids" @input="updateData" :val="props.row.id" color="green" checked-icon="check" unchecked-icon="arrow_forward_ios"></q-toggle>
            </q-td>
          </template>
          <template v-slot:body-cell-grant_assigned="props">
            <q-td auto-width :props="props">
              <q-toggle v-if="props.row.custom_data.grant_requested" size="xs" v-model="event.custom_data.granted_ids" :val="props.row.id" @input="updateData" color="green" checked-icon="check" :disable="disableToggle(props.row)" :unchecked-icon="(disableToggle(props.row)) ? 'null' : 'arrow_forward_ios'" />
              <q-toggle v-else size="xs" v-model="togglePlaceholder" :val="false" color="green" disable class="transparent" />
            </q-td>
          </template>
          <template v-slot:body-cell-country_code="props">
            <q-td auto-width :props="props">
              <country-flag :code="props.row.country.code || props.row.country.value" class="cursor-help">
                <q-tooltip>{{ props.row.country.name || props.row.country.label }}</q-tooltip>
              </country-flag>
            </q-td>
          </template>
          <template v-slot:body-cell-user_gender="props">
            <q-td auto-width :props="props">
              <q-icon :name="{'male': 'male', 'female': 'female', 'non-binary': 'toll', null: 'toll'}[props.row.user_gender]"></q-icon>
            </q-td>
          </template>
          <template v-slot:body-cell-user_affiliation="props">
            <q-td :props="props" class="text-truncate" style="width: 200px">
              <small>{{ props.row.user_affiliation }}</small>
            </q-td>
          </template>
          <template v-slot:body-cell-advisor="props">
            <q-td auto-width :props="props">
              <small>{{ props.row.advisor }}</small>
            </q-td>
          </template>
          <template v-slot:body-cell-acaces_last="props">
            <q-td auto-width :props="props">
              <small>{{ props.row.acaces_last || '-' }} ({{ props.row.acaces_count }})</small>
            </q-td>
          </template>
          <template v-slot:body-cell-presents_poster="props">
            <q-td auto-width :props="props">
              <q-icon v-if="props.row.presents_poster" name="check_circle" color="positive" size="16px" />
              <q-icon v-else name="remove_circle" color="grey-4" size="16px" />
            </q-td>
          </template>
          <template v-slot:body-cell-shares_room="props">
            <q-td auto-width :props="props">
              <q-icon v-if="props.row.shares_room" name="check_circle" color="positive" size="16px" />
              <q-icon v-else name="remove_circle" color="grey-4" size="16px" />
            </q-td>
          </template>
          <template v-slot:body-cell-payment_status="props">
            <q-td auto-width :props="props">
              <q-icon v-if="props.row.paid" name="check_circle" color="positive" size="16px" />
              <q-icon v-else name="remove_circle" color="grey-4" size="16px" />
            </q-td>
          </template>
        </q-table>

        <q-dialog v-model="showDialog" @show="dialogVisible = true">
          <q-card v-if="obj" style="width: 800px; max-width: 95vw;">
            <q-card-section class="q-pb-lg">
              <q-btn flat round v-close-popup icon="close" class="float-right"></q-btn>
              <display-4 class="q-mb-lg">Registration #{{ obj.id }}</display-4>
              <q-list dense>
                <q-item>
                  <q-item-section avatar><q-icon name="schedule"></q-icon></q-item-section>
                  <q-item-section>{{ obj.date.format('LLLL') }}</q-item-section>
                </q-item>
                <q-separator inset="item"></q-separator>
                <q-item>
                  <q-item-section avatar><q-icon name="accessibility_new"></q-icon></q-item-section>
                  <q-item-section><strong>{{ obj.user_name }}</strong></q-item-section>
                </q-item>
                <q-separator inset="item"></q-separator>
                <q-item>
                  <q-item-section avatar><q-icon name="email"></q-icon></q-item-section>
                  <q-item-section>{{ obj.user.email }}</q-item-section>
                </q-item>
                <q-separator inset="item"></q-separator>
                <q-item>
                  <q-item-section avatar><q-icon :name="{'male': 'male', 'female': 'female', 'non_binary': 'toll', null: 'toll'}[obj.user_gender]"></q-icon></q-item-section>
                  <q-item-section class="text-capitalize">{{ obj.user_gender }}</q-item-section>
                </q-item>
                <q-separator inset="item"></q-separator>
                <q-item>
                  <q-item-section avatar><q-icon name="business"></q-icon></q-item-section>
                  <q-item-section>{{ obj.user_affiliation }}</q-item-section>
                </q-item>
                <q-separator v-if="obj.country" inset="item"></q-separator>
                <q-item v-if="obj.country">
                  <q-item-section avatar>
                    <country-flag :code="obj.country.code"></country-flag>
                  </q-item-section>
                  <q-item-section>{{ obj.country.name }}</q-item-section>
                </q-item>
                <q-separator v-if="obj.custom_data.profile.advisor" inset="item"></q-separator>
                <q-item v-if="obj.custom_data.profile.advisor">
                  <q-item-section avatar><q-icon name="supervised_user_circle"></q-icon></q-item-section>
                  <q-item-section>{{ obj.custom_data.profile.advisor }}</q-item-section>
                  <q-item-section side class="text-caption">Advisor</q-item-section>
                </q-item>
                <q-separator inset="item" class="q-mb-md"></q-separator>
                <q-item>
                  <q-item-section avatar><q-icon name="view_week"></q-icon></q-item-section>
                  <q-item-section class="text-body2">
                    <p v-for="course in registrationCourses" :key="course.id" class="q-mb-xs">
                      <small>Slot #{{ course.slot }}:</small> {{ course.title }}
                    </p>
                    <div v-if="registrationTracks.length" class="q-gutter-x-xs q-mt-sm">
                      <q-badge v-for="t in registrationTracks" :key="t.track.project_id" :color="t.track.color" >#{{ t.track.name }}</q-badge>
                    </div>
                  </q-item-section>
                </q-item>
                <q-separator v-if="obj.custom_data.poster.present" inset="item" class="q-my-md"></q-separator>
                <q-item v-if="obj.custom_data.poster.present">
                  <q-item-section avatar><q-icon name="amp_stories"></q-icon></q-item-section>
                  <q-item-section>
                    <p class="text-body2 q-mb-xs">{{ obj.custom_data.poster.title }}</p>
                    <p class="text-caption text-grey-8 q-mb-none">{{ obj.custom_data.poster.authors }}</p>
                  </q-item-section>
                </q-item>
                <q-separator inset="item" class="q-my-md"></q-separator>
                <q-item>
                  <q-item-section avatar><q-icon name="article" class="q-mb-md"></q-icon></q-item-section>
                  <q-item-section>
                    <marked :text="obj.custom_data.motivation" class="text-body2"></marked>
                    <div class="q-gutter-xs q-mt-none">
                      <q-badge v-for="y in years" :key="y" color="grey-2" text-color="grey-7">#{{ y }}</q-badge>
                    </div>
                  </q-item-section>
                </q-item>
                <!--<q-separator v-if="obj.invoice_requested" inset="item" class="q-my-md"></q-separator>
                <q-item v-if="obj.invoice_requested">
                  <q-item-section avatar><q-icon name="grading" :color="(obj.invoice_sent) ? 'positive' : 'orange-7'"></q-icon></q-item-section>
                  <q-item-section v-if="obj.invoice_sent" class="text-positive text-bold">Invoice sent</q-item-section>
                  <q-item-section v-else class="text-orange-7 text-bold">Invoice requested (not sent)</q-item-section>
                </q-item>
                <q-separator inset="item"></q-separator>
                <q-item v-if="obj.is_paid">
                  <q-item-section avatar><q-icon name="done_outline" color="positive"></q-icon></q-item-section>
                  <q-item-section class="text-positive text-bold">Paid</q-item-section>
                </q-item>
                <q-item v-else>
                  <q-item-section avatar><q-icon name="radio_button_unchecked" color="orange-7"></q-icon></q-item-section>
                  <q-item-section class="text-orange-7 text-bold">Pending payment</q-item-section>
                </q-item>-->
              </q-list>
            </q-card-section>
          </q-card>
        </q-dialog>

      </q-card-section>
    </q-card>
  </div>
{% endverbatim %}
</script>
